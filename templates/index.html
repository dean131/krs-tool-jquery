<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>krstool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
</head>
<body class="bg-secondary">
    <div class="container-fluid mt-5">
        <div class="row">
            <!-- FORM -->
            <div class="col-md-4 mb-3">
                <div class="container rounded shadow  bg-white mb-3">
                    <form id="form_matkul">
                        <div class="container row">
                            <div class="mb-3 mt-3">
                                <div id="wadah_alert"></div>
                                <label class="form-label" for="nama_matkul">Nama Matkul</label>
                                <input class="form-control" type="text" id="nama_matkul" required>
                            </div>
                            <div class="mb-3 col-md-4">
                                <label class="form-label" for="hari">Hari</label>
                                <select class="form-select" id="hari" aria-label="Default select example" required>
                                    <option selected>Pilih hari</option>
                                    <option value="senin">Senin</option>
                                    <option value="selasa">Selasa</option>
                                    <option value="rabu">Rabu</option>
                                    <option value="Kamis">Kamis</option>
                                    <option value="jum'at">Jum'at</option>
                                    <option value="sabtu">Sabtu</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label" for="jam_mulai">Jam Mulai</label>
                                <input type="time" id="jam_mulai" class="form-control" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label" for="jam_akhir">Jam Akhir</label>
                                <input type="time" id="jam_akhir" class="form-control" required>
                            </div>
                            <div class="col-md-2 mb-3">
                                <label class="form-label" for="sks">SKS</label>
                                <input class="form-control" type="text" id="jmlh_sks" required>
                            </div>
                            <div class="mb-3">
                                <button type="submit" class="btn btn-primary" id="btn_submit">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
                    <div class="mb-3" id="hitungan"></div>
            </div>
            <!-- AKHIR FORM -->
            
            <!-- TABEL -->
            <div class="col-md-8 mb-3">
                <div class="container rounded-3 shadow bg-white">
                    <div class="table-responsive" style="height: 550px;">
                        <div class="mt-3" id="table_matkul"></div>
                    </div>
                </div>
            </div> 
            <!-- PENUTUP TABEL -->
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
    
            let data_base = [];

            $.tampil = function() {
                let table = `<table class="table table-striped" id="myTable">
                                <thead class="sticky-top bg-secondary text-light">
                                    <tr>
                                        <th>No</th>
                                        <th>Nama Matkul</th>
                                        <th>sks</th>
                                        <th>Hari</th>
                                        <th>Jam</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>`;


                if (data_base) {
                    $.each(data_base, function(index, value) {
                        table +=    `<tr>
                                        <td>${index+1}</td>
                                        <td>${value[0]}</td>
                                        <td>${value[4]}</td>
                                        <td>${value[1]}</td>
                                        <td>${value[2]}-${value[3]}</td>
                                        <td>
                                            <a onclick="$.hapus(${index})" class="btn btn-danger">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                                    <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
                                                </svg>
                                            </a>
                                        </td>
                                    </tr>`;
                    });
                }
                
                table += `</tbody></table>`;
                $('#table_matkul').html(table);

                $.hitungan();
            }

            $('#form_matkul').submit(function(event) {
                event.preventDefault();
                let nama_matkul = $(this).find('#nama_matkul').val();
                let hari = $(this).find('#hari').val();
                let jam_mulai = $(this).find('#jam_mulai').val();
                let jam_akhir = $(this).find('#jam_akhir').val();
                let jmlh_sks = $(this).find('#jmlh_sks').val();
                let data = [nama_matkul, hari, jam_mulai, jam_akhir, jmlh_sks];

                let tabrakan = '';
                $.each(data_base, function(index, value) {
                    if (hari == value[1]) {
                        if (jam_mulai >= value[2] && jam_mulai <= value[3]) {
                            tabrakan = `tabrakan dengan "${value[0]}"`;
                        } else if (jam_akhir >= value[2] && jam_akhir <= value[3]) {
                            tabrakan = `tabrakan dengan "${value[0]}"`;
                        } else if (value[2] >= jam_mulai && value[2] <= jam_akhir) {
                            tabrakan = `tabrakan dengan "${value[0]}"`;
                        } else if (value[3] >= jam_mulai && value[3] <= jam_akhir) {
                            tabrakan = `tabrakan dengan "${value[0]}"`;
                        }
                    }
                });

                if (tabrakan) {
                    let ini_alert = `<div class="alert alert-danger alert-dismissible" role="alert">
                                        <div>${tabrakan}</div>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>`
                    $('#wadah_alert').html(ini_alert);
                } else {
                    data_base.push(data);
                }

                $.tampil();
            });

            $.hapus = function(index) {
                data_base.splice(index, 1);
                $.tampil();
            }

            $.hitungan = function() {
                let total_matkul = data_base.length;
                let total_sks = 0;

                $.each(data_base, function(index, value) {
                    total_sks += parseInt(value[4]);
                });

                let hitung =   `<ul class="list-group">
                                    <li class="list-group-item">Jumlah Mata kuliah: ${total_matkul}</li>
                                    <li class="list-group-item">Total SKS ${total_sks}</li>
                                </ul>`;

                $('#hitungan').html(hitung);
            }

            $.tampil();

        });
    </script>
</body>
</html>